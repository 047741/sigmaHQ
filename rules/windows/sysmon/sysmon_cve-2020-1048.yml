title: Possible CVE-2020-1048 exploitation
id: 7ec912f2-5175-4868-b811-ec13ad0f8567
status: experimental
description: Detects new registry printer port was created or powershell command add new printer port which point to suspicious file
author: EagleEye Team
date: 2020/05/13
references:
    - https://windows-internals.com/printdemon-cve-2020-1048/
logsource:
    service: sysmon
    product: windows
tags:
    - attack.persistence
    - attack.execution
detection:
    registryevent:
        EventID: 12 
    selection: 
        TargetObject: 'HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Ports'
        EventType: CreateKey
    processevent:
        EventID: 1
    selection_2:
        CommandLine|contains: 'Add-PrinterPort -Name'
    selection_3:
        CommandLine:
            - '.dll'
            - '.exe'
    condition: (selection and registryevent) or (processevent and all of selection_*)
falsepositives:
    - New printer port install on host
level: critical

